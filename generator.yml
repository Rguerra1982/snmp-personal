# Bloque de Autenticación
auths:
  comunidad_lectura_v2c:
    version: 2
    community: IUNGO-NOC
  apc_snmpv1:
    version: 1
    community: IUNGO-NOC

# Definición de Módulos
modules:
  # Módulo para Dispositivos Cisco
  cisco_devices:
    walk:
      - sysUpTime
      - interfaces
      - ifXTable
      - ciscoEnvMonTemperatureStatusTable
      - ciscoMemoryPoolTable
      - entSensorValue
      - entSensorType
      - entSensorScale
      - entSensorPrecision
      - entSensorStatus
    lookups:
      - source_indexes: [ifIndex]
        lookup: ifDescr
      - source_indexes: [ifIndex]
        lookup: ifAlias
      - source_indexes: [ifIndex]
        lookup: ifName
      - source_indexes: [ciscoEnvMonTemperatureStatusIndex] # <-- Corregido
        lookup: ciscoEnvMonTemperatureStatusDescr
      - source_indexes: [ciscoMemoryPoolIndex]
        lookup: ciscoMemoryPoolName
    overrides:
      ifAdminStatus: {type: EnumAsStateSet, name: interface_admin_status}
      ifOperStatus: {type: EnumAsStateSet, name: interface_oper_status}
      ifType: {type: EnumAsInfo, name: interface_type}
      ifHCInOctets: {type: counter, name: interface_in_octets_total}
      ifHCOutOctets: {type: counter, name: interface_out_octets_total}
      ifSpeed: {name: interface_speed_bits_per_second}
      ciscoEnvMonTemperatureStatusValue:
        name: cisco_envmon_temperature_celsius
      ciscoMemoryPoolUsed:
        name: cisco_memory_pool_used_bytes
      ciscoMemoryPoolFree:
        name: cisco_memory_pool_free_bytes

  # Módulo para Dispositivos Meraki
  meraki_devices:
    walk:
      - sysUpTime
      - interfaces
      - ifXTable
      - hrMemorySize
      - hrStorageTable
      - entPhySensorTable
    lookups:
      - source_indexes: [ifIndex]
        lookup: ifDescr
      - source_indexes: [ifIndex]
        lookup: ifAlias
      - source_indexes: [ifIndex]
        lookup: ifName
      - source_indexes: [hrStorageIndex] # <-- Corregido
        lookup: hrStorageDescr
      - source_indexes: [entPhysicalIndex] # <-- Corregido
        lookup: entPhysicalDescr
    overrides:
      ifAdminStatus: {type: EnumAsStateSet, name: interface_admin_status}
      ifOperStatus: {type: EnumAsStateSet, name: interface_oper_status}
      ifType: {type: EnumAsInfo, name: interface_type}
      ifHCInOctets: {type: counter, name: interface_in_octets_total}
      ifHCOutOctets: {type: counter, name: interface_out_octets_total}
      ifSpeed: {name: interface_speed_bits_per_second}
      hrMemorySize:
        name: meraki_physical_memory_total_kbytes
      hrStorageType:
        type: EnumAsInfo
      entPhySensorValue:
        name: meraki_sensor_temperature_celsius

  # Módulo para Dispositivos Sophos Firewall
  sophos_firewall:
    walk:
      - sysUpTime
      - interfaces
      - ifXTable
      - hrMemorySize
      - hrStorageTable
      - hrProcessorTable
    lookups:
      - source_indexes: [ifIndex]
        lookup: ifDescr
      - source_indexes: [ifIndex]
        lookup: ifAlias
      - source_indexes: [ifIndex]
        lookup: ifName
      - source_indexes: [hrStorageIndex] # <-- Corregido
        lookup: hrStorageDescr
    overrides:
      ifAdminStatus: {type: EnumAsStateSet, name: interface_admin_status}
      ifOperStatus: {type: EnumAsStateSet, name: interface_oper_status}
      ifType: {type: EnumAsInfo, name: interface_type}
      ifHCInOctets: {type: counter, name: interface_in_octets_total}
      ifHCOutOctets: {type: counter, name: interface_out_octets_total}
      ifSpeed: {name: interface_speed_bits_per_second}
      hrMemorySize:
        name: sophos_physical_memory_total_kbytes
      hrProcessorLoad:
        name: sophos_processor_load_percent

  # Módulo para Dispositivos Fortinet Firewall
  fortinet_firewall:
    walk:
      - sysUpTime
      - interfaces
      - ifXTable
      - 1.3.6.1.4.1.12356.101.4.1.3    # fgSysMemCapacity
      - 1.3.6.1.4.1.12356.101.4.1.4    # fgSysMemUsage
      - 1.3.6.1.4.1.12356.101.12.2.2.1 # fgVpnTunEntTable
    lookups:
      - source_indexes: [ifIndex]
        lookup: ifDescr
      - source_indexes: [ifIndex]
        lookup: ifAlias
      - source_indexes: [ifIndex]
        lookup: ifName
      - source_indexes: [fgVpnTunEntIndex] # <-- Corregido
        lookup: 1.3.6.1.4.1.12356.101.12.2.2.1.1 # fgVpnTunEntName
    overrides:
      ifAdminStatus: {type: EnumAsStateSet, name: interface_admin_status}
      ifOperStatus: {type: EnumAsStateSet, name: interface_oper_status}
      ifType: {type: EnumAsInfo, name: interface_type}
      ifHCInOctets: {type: counter, name: interface_in_octets_total}
      ifHCOutOctets: {type: counter, name: interface_out_octets_total}
      ifSpeed: {name: interface_speed_bits_per_second}
      fgSysMemCapacity:
        name: fortinet_memory_total_kbytes
      fgSysMemUsage:
        name: fortinet_memory_usage_percent

  # Módulo para SAI APC (SNMPv1)
  apc_ups:
    walk:
      - upsIdentManufacturer
      - upsIdentModel
      - upsBatteryStatus
      - upsEstimatedMinutesRemaining
      - upsEstimatedChargeRemaining
      - upsOutputSource
      - upsAdvBatteryReplaceIndicator
      - upsAdvBatteryTemperature
      - upsBasicOutputStatus
      - upsAdvOutputLoad
      - upsHighPrecBatteryCapacity
      - upsHighPrecOutputLoad
      - 1.3.6.1.4.1.318.1.1.10.2.3.2.1 # No es un error, pero es una tabla. Revisar si es necesario un walk específico.
      - upsAdvStateAbnormalConditions
    lookups:
      - source_indexes: [upsAlarmId]
        lookup: upsAlarmDescr
    overrides:
      upsBatteryStatus:
        type: EnumAsStateSet
        name: apc_ups_battery_status
      upsOutputSource:
        type: EnumAsStateSet
        name: apc_ups_output_source
      upsBasicOutputStatus:
        type: EnumAsStateSet
        name: apc_ups_basic_output_status
      upsAdvBatteryReplaceIndicator:
        type: EnumAsInfo
        name: apc_ups_battery_replace_indicator
      upsAdvBatteryTemperature:
        name: apc_ups_battery_temperature_celsius
      upsHighPrecBatteryCapacity:
        name: apc_ups_battery_capacity_percent
      upsHighPrecOutputLoad:
        name: apc_ups_output_load_percent
      upsAdvStateAbnormalConditions:
        name: apc_ups_abnormal_conditions_flags
